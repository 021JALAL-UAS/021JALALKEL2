<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PZEM Monitoring - Dark Fixed</title>

<!-- Gauges -->
<script src="https://cdn.jsdelivr.net/npm/canvas-gauges@2.1.7/gauge.min.js"></script>

<!-- Chart JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body {
    background: #0d0f14 !important;
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    padding: 25px;
    color: #ffffff !important;
  }

  h2 {
    text-align: center;
    margin: 5px 0;
    color: #ffffff !important;
    font-weight: 600;
  }

  .container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 25px;
    margin-top: 20px;
  }

  .card {
    background: #161a22 !important;
    padding: 18px;
    width: 250px;
    border-radius: 18px;
    text-align: center;
    box-shadow: 0 0 12px rgba(0,0,0,0.55);
  }

  .value-text {
    margin-top: 12px;
    font-size: 26px;
    font-weight: bold;
    color: #e0e0e0 !important;
  }

  #chartBox {
    background: #161a22 !important;
    margin: 40px auto;
    width: 95%;
    max-width: 1200px;
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 0 12px rgba(0,0,0,0.55);
  }
</style>

</head>
<body>

<h2>PZEM Real-Time Monitoring</h2>
<h2>Dark Mode â€“ FIXED 2025</h2>

<!-- ===================== GAUGES ======================= -->
<div class="container">

  <div class="card">
    <canvas id="gVolt"
      data-type="radial-gauge"
      data-width="230" data-height="230"
      data-min-value="0" data-max-value="300"
      data-major-ticks="0,50,100,150,200,250,300"
      data-color-plate="#161a22"
      data-units="Volt"
      data-color-value="#4FC3F7"></canvas>
    <div class="value-text" id="vVolt">0 V</div>
  </div>

  <div class="card">
    <canvas id="gArus"
      data-type="radial-gauge"
      data-width="230" data-height="230"
      data-min-value="0" data-max-value="50"
      data-major-ticks="0,10,20,30,40,50"
      data-color-plate="#161a22"
      data-units="Amp"
      data-color-value="#81C784"></canvas>
    <div class="value-text" id="vArus">0 A</div>
  </div>

  <div class="card">
    <canvas id="gDaya"
      data-type="radial-gauge"
      data-width="230" data-height="230"
      data-min-value="0" data-max-value="5000"
      data-major-ticks="0,1000,2000,3000,4000,5000"
      data-color-plate="#161a22"
      data-units="Watt"
      data-color-value="#FFB74D"></canvas>
    <div class="value-text" id="vDaya">0 W</div>
  </div>

  <div class="card">
    <canvas id="gKwh"
      data-type="radial-gauge"
      data-width="230" data-height="230"
      data-min-value="0" data-max-value="100"
      data-major-ticks="0,20,40,60,80,100"
      data-color-plate="#161a22"
      data-units="kWh"
      data-color-value="#BA68C8"></canvas>
    <div class="value-text" id="vKwh">0 kWh</div>
  </div>

  <div class="card">
    <canvas id="gFrek"
      data-type="radial-gauge"
      data-width="230" data-height="230"
      data-min-value="40" data-max-value="60"
      data-major-ticks="40,45,50,55,60"
      data-color-plate="#161a22"
      data-units="Hz"
      data-color-value="#F06292"></canvas>
    <div class="value-text" id="vFrek">50 Hz</div>
  </div>

  <div class="card">
    <canvas id="gPf"
      data-type="radial-gauge"
      data-width="230" data-height="230"
      data-min-value="0" data-max-value="1"
      data-major-ticks="0,0.2,0.4,0.6,0.8,1"
      data-color-plate="#161a22"
      data-color-value="#FFD54F"></canvas>
    <div class="value-text" id="vPf">0.00</div>
  </div>

</div>

<!-- ===================== REAL TIME CHART ======================= -->
<div id="chartBox">
  <canvas id="chartAll"></canvas>
</div>

<script>
window.addEventListener("load", () => {
  setTimeout(() => {

    // Ambil Gauge
    let gV = gauges[0];
    let gA = gauges[1];
    let gW = gauges[2];
    let gK = gauges[3];
    let gF = gauges[4];
    let gPf = gauges[5];

    // ===================== CHART =====================
    const ctx = document.getElementById("chartAll");
    const chartAll = new Chart(ctx, {
      type: "line",
      data: {
        labels: [],
        datasets: [
          { label: "Volt (V)", borderColor: "#4FC3F7", data: [], borderWidth: 2 },
          { label: "Arus (A)", borderColor: "#81C784", data: [], borderWidth: 2 },
          { label: "Daya (W)", borderColor: "#FFB74D", data: [], borderWidth: 2 },
          { label: "Energi (kWh)", borderColor: "#BA68C8", data: [], borderWidth: 2 },
          { label: "Frekuensi (Hz)", borderColor: "#F06292", data: [], borderWidth: 2 },
          { label: "PF", borderColor: "#FFD54F", data: [], borderWidth: 2 }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: false,
        plugins: {
          legend: { labels: { color: "#ffffff" } }
        },
        scales: {
          x: {
            ticks: { color: "#ffffff" },
            grid: { color: "#333" }
          },
          y: {
            ticks: { color: "#ffffff" },
            grid: { color: "#333" }
          }
        }
      }
    });

    // ===================== UPDATE DATA =====================
    setInterval(() => {
      let volt = 210 + Math.random() * 40;
      let arus = Math.random() * 10;
      let daya = volt * arus;
      let kwh  = (Math.random() * 10).toFixed(2);
      let frek = 49 + Math.random() * 2;
      let pf   = (0.6 + Math.random() * 0.4).toFixed(2);

      // Gauge
      gV.value = volt;
      gA.value = arus;
      gW.value = daya;
      gK.value = kwh;
      gF.value = frek;
      gPf.value = pf;

      // Text
      document.getElementById("vVolt").innerHTML = volt.toFixed(1) + " V";
      document.getElementById("vArus").innerHTML = arus.toFixed(2) + " A";
      document.getElementById("vDaya").innerHTML = daya.toFixed(0) + " W";
      document.getElementById("vKwh").innerHTML = kwh + " kWh";
      document.getElementById("vFrek").innerHTML = frek.toFixed(2) + " Hz";
      document.getElementById("vPf").innerHTML = pf;

      // Chart
      const t = new Date().toLocaleTimeString();

      chartAll.data.labels.push(t);
      chartAll.data.datasets[0].data.push(volt);
      chartAll.data.datasets[1].data.push(arus);
      chartAll.data.datasets[2].data.push(daya);
      chartAll.data.datasets[3].data.push(kwh);
      chartAll.data.datasets[4].data.push(frek);
      chartAll.data.datasets[5].data.push(pf);

      if (chartAll.data.labels.length > 15) {
        chartAll.data.labels.shift();
        chartAll.data.datasets.forEach(ds => ds.data.shift());
      }

      chartAll.update();

    }, 1000);

  }, 800);
});
</script>

</body>
</html>
